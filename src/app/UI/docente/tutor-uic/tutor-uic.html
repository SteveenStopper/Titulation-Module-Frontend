<section class="space-y-4">
  <!-- Header -->
  <div class="bg-white rounded-xl border border-gray-200 shadow-sm px-4 py-3">
    <h1 class="text-xl font-bold text-gray-800">Tutor UIC</h1>
    <p class="text-gray-600 text-sm">Gestión de avance y calificaciones por parciales.</p>
  </div>

  <!-- Avance -->
  <div *ngIf="tab==='avance'" class="bg-white rounded-xl border border-gray-200 shadow-sm">
    <div class="px-4 py-3 border-b">
      <h2 class="font-semibold text-gray-800">Notas por parciales</h2>
      <p class="text-sm text-gray-500">Ingrese las notas sobre 10. El promedio se calcula automáticamente.</p>
    </div>
    <div class="p-4 overflow-x-auto">
      <table class="min-w-full text-sm table-auto">
        <thead class="bg-gray-50 text-gray-700 text-xs uppercase tracking-wide">
          <tr>
            <th class="px-3 py-2 text-left">Estudiante</th>
            <th class="px-3 py-2 text-left">P1</th>
            <th class="px-3 py-2 text-left">P2</th>
            <th class="px-3 py-2 text-left">P3</th>
            <th class="px-3 py-2 text-left">Promedio Final</th>
            <th class="px-3 py-2 text-left">Documento</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <tr *ngFor="let e of estudiantes" class="odd:bg-white even:bg-gray-50">
            <td class="px-3 py-2 font-medium text-gray-800">{{ e.nombre }}</td>
            <td class="px-3 py-2">
              <div class="flex items-start gap-2">
                <input type="number" step="0.1" min="0" max="10" [(ngModel)]="e.p1.nota" (blur)="clampNota(e,'p1')"
                       [disabled]="!puedeEditar(e,'p1')"
                       class="w-20 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="0-10" />
                <input type="text" [(ngModel)]="e.p1.obs" [disabled]="!puedeEditar(e,'p1')"
                       class="w-44 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="Obs. P1" />
              </div>
              <div class="mt-1 flex items-center gap-2 text-xs">
                <button *ngIf="puedeEditar(e,'p1')" (click)="guardar(e,'p1')" class="px-2 py-0.5 rounded bg-emerald-600 text-white hover:bg-emerald-700">Guardar</button>
                <button *ngIf="puedeMostrarEditar(e,'p1')" (click)="editar(e,'p1')" class="px-2 py-0.5 rounded bg-indigo-600 text-white hover:bg-indigo-700">Editar</button>
                <button *ngIf="puedePublicar(e,'p1')" (click)="publicarParcial(e,'p1')" class="px-2 py-0.5 rounded bg-gray-900 text-white">Publicar</button>
              </div>
            </td>
            <td class="px-3 py-2">
              <div class="flex items-start gap-2">
                <input type="number" step="0.1" min="0" max="10" [(ngModel)]="e.p2.nota" (blur)="clampNota(e,'p2')"
                       [disabled]="!puedeEditar(e,'p2')"
                       class="w-20 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="0-10" />
                <input type="text" [(ngModel)]="e.p2.obs" [disabled]="!puedeEditar(e,'p2')"
                       class="w-44 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="Obs. P2" />
              </div>
              <div class="mt-1 flex items-center gap-2 text-xs">
                <button *ngIf="puedeEditar(e,'p2')" (click)="guardar(e,'p2')" class="px-2 py-0.5 rounded bg-emerald-600 text-white hover:bg-emerald-700">Guardar</button>
                <button *ngIf="puedeMostrarEditar(e,'p2')" (click)="editar(e,'p2')" class="px-2 py-0.5 rounded bg-indigo-600 text-white hover:bg-indigo-700">Editar</button>
                <button *ngIf="puedePublicar(e,'p2')" (click)="publicarParcial(e,'p2')" class="px-2 py-0.5 rounded bg-gray-900 text-white">Publicar</button>
              </div>
            </td>
            <td class="px-3 py-2">
              <div class="flex items-start gap-2">
                <input type="number" step="0.1" min="0" max="10" [(ngModel)]="e.p3.nota" (blur)="clampNota(e,'p3')"
                       [disabled]="!puedeEditar(e,'p3')"
                       class="w-20 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="0-10" />
                <input type="text" [(ngModel)]="e.p3.obs" [disabled]="!puedeEditar(e,'p3')"
                       class="w-44 px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:text-gray-500" placeholder="Obs. P3" />
              </div>
              <div class="mt-1 flex items-center gap-2 text-xs">
                <button *ngIf="puedeEditar(e,'p3')" (click)="guardar(e,'p3')" class="px-2 py-0.5 rounded bg-emerald-600 text-white hover:bg-emerald-700">Guardar</button>
                <button *ngIf="puedeMostrarEditar(e,'p3')" (click)="editar(e,'p3')" class="px-2 py-0.5 rounded bg-indigo-600 text-white hover:bg-indigo-700">Editar</button>
                <button *ngIf="puedePublicar(e,'p3')" (click)="publicarParcial(e,'p3')" class="px-2 py-0.5 rounded bg-gray-900 text-white">Publicar</button>
              </div>
            </td>
            <td class="px-3 py-2">
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                    [ngClass]="{
                      'bg-emerald-50 text-emerald-700': (promedio(e) ?? 0) >= 7,
                      'bg-amber-50 text-amber-700': (promedio(e) ?? 0) >= 5 && (promedio(e) ?? 0) < 7,
                      'bg-rose-50 text-rose-700': (promedio(e) ?? 0) > 0 && (promedio(e) ?? 0) < 5
                    }">
                {{ promedio(e) === null ? '-' : promedio(e) }} / 10
              </span>
            </td>

            <td class="px-3 py-2">
              <button type="button" (click)="verDocumento(e)"
                      [disabled]="!e.documentoId"
                      class="px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60 text-xs">
                Ver documento
              </button>
            </td>
            
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
